<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Random Number from Image Pixel</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            overflow-x: hidden;
        }
        .container {
            text-align: center;
            width: 90%;
            max-width: 600px;
            padding: 20px;
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }
        h1 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.8em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        .image-container {
            position: relative;
            margin: 20px auto;
            width: 100%;
            max-width: 500px;
            height: auto;
            aspect-ratio: 5 / 4;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        canvas {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 10px;
            transition: all 0.5s ease;
        }
        canvas:hover {
            transform: scale(1.02);
        }
        button {
            padding: 10px 20px;
            font-size: 14px;
            cursor: pointer;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 50px;
            transition: all 0.3s ease;
            margin: 10px 5px;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
        }
        button:hover {
            background-color: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 7px 20px rgba(41, 128, 185, 0.4);
        }
        #randomNumber {
            margin-top: 20px;
            font-size: 20px;
            color: #2c3e50;
            font-weight: bold;
            transition: all 0.5s ease;
        }
        #pixel {
            position: absolute;
            width: 1px;
            height: 1px;
            transition: all 1s cubic-bezier(0.68, -0.55, 0.27, 1.55);
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
            border-radius: 50%;
            z-index: 1;
        }
        #animationContainer {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 20px;
        }
        .step {
            margin: 10px 0;
            font-size: 16px;
            opacity: 0;
            transition: all 0.5s ease;
            background-color: rgba(52, 152, 219, 0.1);
            padding: 8px 15px;
            border-radius: 25px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }
        .arrow {
            font-size: 20px;
            margin: 5px 0;
            color: #3498db;
            opacity: 0.3;
            transition: all 0.3s ease;
        }
        .arrow.active {
            opacity: 1;
            animation: bounce 1s infinite;
        }
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        .arrow svg {
            width: 24px;
            height: 24px;
            fill: currentColor;
        }
        #generateNewImage {
            background-color: #2ecc71;
        }
        #generateNewImage:hover {
            background-color: #27ae60;
        }
        .range-inputs {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 15px;
        }
        .range-inputs input {
            width: 80px;
            padding: 8px;
            border: 2px solid #3498db;
            border-radius: 25px;
            text-align: center;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        .range-inputs input:focus {
            outline: none;
            box-shadow: 0 0 10px rgba(52, 152, 219, 0.5);
        }
        .coordinate-marker {
            position: absolute;
            width: 20px;
            height: 20px;
            border: 2px solid red;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            pointer-events: none;
            transition: all 0.5s ease;
            box-shadow: 0 0 10px rgba(255,0,0,0.5);
        }
        #currentCoordinate {
            border-color: #e74c3c;
        }
        #nextStepButton {
            display: none;
            margin-top: 15px;
        }

        @media (max-width: 600px) {
            .container {
                padding: 15px;
            }
            h1 {
                font-size: 1.5em;
            }
            button {
                padding: 8px 16px;
                font-size: 12px;
            }
            #randomNumber {
                font-size: 18px;
            }
            .step {
                font-size: 14px;
                padding: 6px 12px;
            }
            .range-inputs input {
                width: 70px;
                padding: 6px;
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Random Number from Image Pixel</h1>
        <div class="image-container">
            <canvas id="imageCanvas"></canvas>
            <div id="pixel"></div>
            <div id="currentCoordinate" class="coordinate-marker"></div>
        </div>
        <div class="range-inputs">
            <input type="number" id="minRange" placeholder="Min" value="0">
            <input type="number" id="maxRange" placeholder="Max" value="100">
        </div>
        <button id="generateButton">Generate Number</button>
        <button id="generateNewImage">New Image</button>
        <button id="nextStepButton">Next Step</button>
        <p id="randomNumber"><strong>Generated Number:</strong> <span id="generatedValue">-</span></p>
        <div id="animationContainer">
            <div id="hexStep" class="step"></div>
            <div class="arrow" id="arrow1">
                <svg viewBox="0 0 24 24">
                    <path d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"/>
                </svg>
            </div>
            <div id="decimalStep" class="step"></div>
            <div class="arrow" id="arrow2">
                <svg viewBox="0 0 24 24">
                    <path d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"/>
                </svg>
            </div>
            <div id="moduloStep" class="step"></div>
            <div class="arrow" id="arrow3">
                <svg viewBox="0 0 24 24">
                    <path d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"/>
                </svg>
            </div>
            <div id="newCoordsStep" class="step"></div>
        </div>
    </div>
    <script>
        let lastX, lastY, ctx;
        let isFirstGeneration = true;
        let currentActiveArrow = null;
        let currentStep = 0;
        let hexColor, randomNumber, range, minRange;
        let canvasWidth, canvasHeight;

        window.onload = function() {
            const canvas = document.getElementById('imageCanvas');
            ctx = canvas.getContext('2d');
            resizeCanvas();
            loadNewImage();

            document.getElementById('generateButton').onclick = startGeneration;
            document.getElementById('generateNewImage').onclick = loadNewImage;
            document.getElementById('nextStepButton').onclick = nextStep;
            window.addEventListener('resize', resizeCanvas);
        };

        function resizeCanvas() {
            const canvas = document.getElementById('imageCanvas');
            const container = document.querySelector('.image-container');
            canvasWidth = container.offsetWidth;
            canvasHeight = container.offsetHeight;
            canvas.width = canvasWidth;
            canvas.height = canvasHeight;
            lastX = canvasWidth / 2;
            lastY = canvasHeight / 2;
            if (ctx) {
                loadNewImage();
            }
            updateCoordinateMarkers();
        }

        function loadNewImage() {
            const image = new Image();
            image.crossOrigin = "Anonymous";
            image.src = `https://picsum.photos/${canvasWidth}/${canvasHeight}?` + new Date().getTime();
            image.onload = function() {
                ctx.drawImage(image, 0, 0, canvasWidth, canvasHeight);
                resetView();
                animateImageLoad();
            };
        }

        function animateImageLoad() {
            const canvas = document.getElementById('imageCanvas');
            canvas.style.opacity = '0';
            canvas.style.transform = 'scale(0.9)';
            setTimeout(() => {
                canvas.style.transition = 'all 0.5s ease';
                canvas.style.opacity = '1';
                canvas.style.transform = 'scale(1)';
            }, 50);
        }

        function startGeneration() {
            if (!isFirstGeneration) {
                resetView();
            }
            isFirstGeneration = false;

            const pixelData = ctx.getImageData(lastX, lastY, 1, 1).data;
            hexColor = rgbToHex(pixelData[0], pixelData[1], pixelData[2]);
            minRange = parseInt(document.getElementById('minRange').value);
            maxRange = parseInt(document.getElementById('maxRange').value);
            range = maxRange - minRange + 1;
            randomNumber = (parseInt(hexColor, 16) % range) + minRange;

            currentStep = 0;
            document.getElementById('nextStepButton').style.display = 'inline-block';
            nextStep();
        }

        function nextStep() {
            switch(currentStep) {
                case 0:
                    animatePixel();
                    break;
                case 1:
                    animateStep('hexStep', `Hex: #${hexColor}`, 'arrow1');
                    break;
                case 2:
                    animateStep('decimalStep', `Decimal: ${parseInt(hexColor, 16)}`, 'arrow2');
                    break;
                case 3:
                    animateStep('moduloStep', `Modulo ${range} + ${minRange}: ${randomNumber}`, 'arrow3');
		    showFinalNumber();
                    break;
                case 4:
                    showNewCoordinates();
                    document.getElementById('nextStepButton').style.display = 'none';
                    break;
            }
            currentStep++;
        }

        function animatePixel() {
            const pixel = document.getElementById('pixel');
            pixel.style.left = `${lastX}px`;
            pixel.style.top = `${lastY}px`;
            pixel.style.backgroundColor = `#${hexColor}`;

            setTimeout(() => {
                pixel.style.left = `${canvasWidth + 10}px`;
                pixel.style.width = '50px';
                pixel.style.height = '50px';
            }, 100);
        }

        function animateStep(elementId, text, arrowId) {
            const element = document.getElementById(elementId);
            element.textContent = text;
            element.style.opacity = 0;
            element.style.transform = 'translateY(20px)';
            setTimeout(() => {
                element.style.opacity = 1;
                element.style.transform = 'translateY(0)';
                activateArrow(arrowId);
            }, 50);
        }

        function showFinalNumber() {
            document.getElementById('generatedValue').textContent = randomNumber;
            document.getElementById('randomNumber').style.transform = 'scale(1.1)';
            setTimeout(() => {
                document.getElementById('randomNumber').style.transform = 'scale(1)';
            }, 300);
        }

        function showNewCoordinates() {
            nextCoordinates(hexColor);
            animateStep('newCoordsStep', `New coordinates: (${Math.round(lastX)}, ${Math.round(lastY)})`, null);
            updateCoordinateMarkers();
            stopArrowAnimations();
        }

        function activateArrow(arrowId) {
            if (currentActiveArrow) {
                document.getElementById(currentActiveArrow).classList.remove('active');
            }
            currentActiveArrow = arrowId;
            if (arrowId) {
                document.getElementById(arrowId).classList.add('active');
            }
        }

        function stopArrowAnimations() {
            if (currentActiveArrow) {
                document.getElementById(currentActiveArrow).classList.remove('active');
                currentActiveArrow = null;
            }
        }

        function resetView() {
            const pixel = document.getElementById('pixel');
            pixel.style.transition = 'none';
            pixel.style.left = `${lastX}px`;
            pixel.style.top = `${lastY}px`;
            pixel.style.width = '1px';
            pixel.style.height = '1px';
            setTimeout(() => {
                pixel.style.transition = 'all 1s cubic-bezier(0.68, -0.55, 0.27, 1.55)';
            }, 50);

            document.querySelectorAll('.step').forEach(step => {
                step.style.opacity =  0;
                step.style.transform = 'translateY(20px)';
            });

            stopArrowAnimations();
            document.getElementById('nextStepButton').style.display = 'none';
        }

        function rgbToHex(r, g, b) {
            return ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1).toUpperCase();
        }

        function nextCoordinates(hexColor) {
            const seed = parseInt(hexColor, 16);
            const canvasWidth = 500;
            const canvasHeight = 400;
            lastX = (seed % canvasWidth);
            lastY = (seed % canvasHeight);
        }

        function updateCoordinateMarkers() {
            const currentMarker = document.getElementById('currentCoordinate');
            currentMarker.style.opacity = '0';
            currentMarker.style.transform = 'translate(-50%, -50%) scale(0.5)';

            setTimeout(() => {
                currentMarker.style.left = `${lastX}px`;
                currentMarker.style.top = `${lastY}px`;
                currentMarker.style.opacity = '1';
                currentMarker.style.transform = 'translate(-50%, -50%) scale(1)';
            }, 100);
        }
    </script>
</body>
</html>
